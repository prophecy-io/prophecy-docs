{
  "openapi": "3.0.3",
  "info": {
    "title": "Prophecy API - Fabrics",
    "description": "API for managing Prophecy fabrics",
    "version": "1.0.0"
  },
  "components": {
    "parameters": {
      "X-AUTH-TOKEN": {
        "name": "X-AUTH-TOKEN",
        "in": "header",
        "description": "Prophecy authentication token. Required for all API requests.",
        "required": true,
        "schema": {
          "type": "string"
        }
      }
    }
  },
  "paths": {
    "/api/orchestration/fabric": {
      "post": {
        "tags": ["Fabrics"],
        "summary": "Create a new fabric",
        "description": "Create an orchestration fabric with optional secret and connection. You can only add one secret and one connection in the same request. Secret and connection properties vary per secret type and connection type.",
        "operationId": "createFabric",
        "parameters": [
          {
            "$ref": "#/components/parameters/X-AUTH-TOKEN"
          }
        ],
        "requestBody": {
          "description": "Fabric creation request with optional secret and connection",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["name", "teamName", "provider"],
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Name of the fabric to be created."
                  },
                  "description": {
                    "type": "string",
                    "description": "Optional description of the fabric."
                  },
                  "teamName": {
                    "type": "string",
                    "description": "Name of the team that owns the fabric."
                  },
                  "provider": {
                    "type": "string",
                    "description": "SQL warehouse provider for the fabric. Prophecy supports two values: `databricks` and `bigquery`."
                  },
                  "dataplaneUrl": {
                    "type": "string",
                    "description": "Optional dataplane URL for the fabric."
                  },
                  "secret": {
                    "type": "object",
                    "required": ["kind", "subKind", "properties"],
                    "properties": {
                      "kind": {
                        "type": "string",
                        "description": "Secret kind. Must be 'prophecy'.",
                        "enum": ["prophecy"]
                      },
                      "subKind": {
                        "type": "string",
                        "description": "Secret sub-type (e.g., 'text', 'm2m'). Secret properties vary by subKind. Refer to the orchestration API in the networks tab for specific property schemas."
                      },
                      "properties": {
                        "type": "object",
                        "description": "Secret properties that vary by subKind. The schema is specification-driven and depends on the subKind value. Refer to the orchestration API documentation for property schemas specific to each secret type.",
                        "additionalProperties": true
                      }
                    },
                    "description": "Optional secret to be created with the fabric. Only one secret can be added per request."
                  },
                  "connection": {
                    "type": "object",
                    "required": ["name", "kind", "isDefaultWarehouseConnection"],
                    "properties": {
                      "name": {
                        "type": "string",
                        "description": "Name of the connection."
                      },
                      "kind": {
                        "type": "string",
                        "description": "Type of connection (e.g., 'databricks', 'bigquery'). Connection properties vary by kind."
                      },
                      "isDefaultWarehouseConnection": {
                        "type": "boolean",
                        "description": "Whether this connection should be set as the default warehouse connection."
                      },
                      "properties": {
                        "type": "object",
                        "description": "Connection properties that vary by connection kind. The schema depends on the connection type. In connection properties, replace secret field references with the string '{{SECRET}}' as secret_id is not available during creation.",
                        "additionalProperties": true
                      },
                      "category": {
                        "type": "string",
                        "description": "Optional category for the connection."
                      },
                      "metadataUserID": {
                        "type": "string",
                        "description": "Optional metadata user ID."
                      },
                      "shouldValidate": {
                        "type": "boolean",
                        "description": "Whether to validate the connection. Defaults to true.",
                        "default": true
                      },
                      "shouldTest": {
                        "type": "boolean",
                        "description": "Whether to test the connection. Defaults to true.",
                        "default": true
                      }
                    },
                    "description": "Optional connection to be created with the fabric. Only one connection can be added per request. It often makes sense to create the connection for your SQL warehouse when creating the fabric. This means you would set `isDefaultWarehouseConnection` to `true`."
                  }
                }
              },
              "example": {
                "name": "API_fab",
                "description": "desc123",
                "teamName": "devTeam",
                "provider": "databricks",
                "secret": {
                  "subKind": "text",
                  "properties": {
                    "name": "secret123",
                    "value": "secret_value"
                  },
                  "kind": "prophecy"
                },
                "connection": {
                  "name": "databricks_1",
                  "kind": "databricks",
                  "properties": {
                    "authType": "pat",
                    "oAuthType": "u2m",
                    "clientId": "",
                    "oAuthAppRegistrationID": "",
                    "provider": "",
                    "kgConfig": {
                      "kgSchedule": {},
                      "authProperties": {
                        "authType": "oauth",
                        "oAuthType": "m2m",
                        "clientId": "",
                        "oAuthAppRegistrationID": ""
                      }
                    },
                    "jdbcUrl": "jdbc:databricks://dbc-ac0e9adb-13fb.cloud.databricks.com:443/default;transportMode=http;ssl=1;AuthMech=3;httpPath=/sql/1.0/warehouses/2dc4d06bcada6a51;",
                    "catalog": "tanmay",
                    "schema": "default",
                    "token": "{{SECRET}}"
                  },
                  "isDefaultWarehouseConnection": true
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Fabric created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "description": "Indicates the request was successful.",
                      "enum": [true]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "description": "The fabric ID of the created fabric."
                        }
                      },
                      "description": "Response data containing the fabric ID."
                    }
                  }
                },
                "example": {
                  "success": true,
                  "data": {
                    "id": "10740"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Fabric creation failed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "message"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "description": "Indicates the request failed.",
                      "enum": [false]
                    },
                    "message": {
                      "type": "string",
                      "description": "Error message describing why the request failed."
                    }
                  }
                },
                "example": {
                  "success": false,
                  "message": "Fabric creation failed due to : Fabric with name `API_fabric_test` already exists in the team"
                }
              }
            }
          }
        }
      }
    },
    "/api/orchestration/fabric/{fabricId}": {
      "parameters": [
        {
          "name": "fabricId",
          "in": "path",
          "description": "The unique ID of the fabric",
          "required": true,
          "schema": {
            "type": "string"
          }
        }
      ],
      "get": {
        "tags": ["Fabrics"],
        "summary": "Get fabric details",
        "description": "Retrieve details for a specific fabric by its ID.",
        "operationId": "getFabricById",
        "parameters": [
          {
            "$ref": "#/components/parameters/X-AUTH-TOKEN"
          }
        ],
        "responses": {
          "200": {
            "description": "Fabric resource found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "description": "Indicates the request was successful.",
                      "enum": [true]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "fabricID": {
                          "type": "string",
                          "description": "The unique identifier for the fabric."
                        },
                        "name": {
                          "type": "string",
                          "description": "The human-readable name of the fabric."
                        },
                        "teamID": {
                          "type": "string",
                          "description": "The unique identifier of the team that owns the fabric."
                        }
                      },
                      "description": "Response data containing fabric details."
                    }
                  }
                },
                "example": {
                  "success": true,
                  "data": {
                    "fabricID": "10740",
                    "name": "API_fabric_test",
                    "teamID": "1200"
                  }
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": ["Fabrics"],
        "summary": "Update an existing fabric",
        "description": "Update the name or description of an existing fabric. Only name and description can be modified.",
        "operationId": "updateFabric",
        "parameters": [
          {
            "$ref": "#/components/parameters/X-AUTH-TOKEN"
          }
        ],
        "requestBody": {
          "description": "Fabric object with updated fields. Only name and description can be modified.",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "The human-readable name of the fabric."
                  },
                  "description": {
                    "type": "string",
                    "description": "Optional description of the fabric."
                  }
                }
              },
              "example": {
                "name": "APIfabrictestupdate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Fabric updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "description": "Indicates the request was successful.",
                      "enum": [true]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "description": "The unique identifier for the fabric."
                        }
                      },
                      "description": "Response data containing the fabric ID."
                    }
                  }
                },
                "example": {
                  "success": true,
                  "data": {
                    "id": "10740"
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Fabrics"],
        "summary": "Delete a fabric",
        "operationId": "deleteFabric",
        "parameters": [
          {
            "$ref": "#/components/parameters/X-AUTH-TOKEN"
          }
        ],
        "responses": {
          "200": {
            "description": "Fabric deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "description": "Indicates the request was successful.",
                      "enum": [true]
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "description": "The unique identifier for the deleted fabric."
                        }
                      },
                      "description": "Response data containing the fabric ID."
                    }
                  }
                },
                "example": {
                  "success": true,
                  "data": {
                    "id": "10743"
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
