{
  "openapi": "3.0.3",
  "info": {
    "title": "Prophecy API",
    "description": "API for managing Prophecy resources",
    "version": "1.0.0"
  },
  "paths": {
    "/orchestration/fabric": {
      "post": {
        "tags": ["Orchestration Fabric"],
        "summary": "Create a new Fabric resource",
        "operationId": "createFabric",
        "requestBody": {
          "description": "Fabric object to be created",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FabricCreate"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Fabric created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Fabric"
                }
              }
            }
          }
        }
      }
    },
    "/orchestration/fabric/{fabricId}": {
      "parameters": [
        {
          "name": "fabricId",
          "in": "path",
          "description": "The unique ID of the Fabric resource",
          "required": true,
          "schema": {
            "type": "string"
          }
        }
      ],
      "get": {
        "tags": ["Orchestration Fabric"],
        "summary": "Retrieve a specific Fabric resource",
        "operationId": "getFabricById",
        "responses": {
          "200": {
            "description": "Fabric resource found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Fabric"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": ["Orchestration Fabric"],
        "summary": "Update an existing Fabric resource",
        "operationId": "updateFabric",
        "requestBody": {
          "description": "Fabric object with updated fields",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FabricUpdate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Fabric updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Fabric"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Orchestration Fabric"],
        "summary": "Delete a specific Fabric resource",
        "operationId": "deleteFabric",
        "x-mint": {
          "playground": "none"
        },
        "responses": {
          "204": {
            "description": "Fabric deleted successfully"
          }
        }
      }
    },
    "/orchestration/fabric/{fabricId}/secret": {
      "parameters": [
        {
          "name": "fabricId",
          "in": "path",
          "description": "The unique ID of the parent Fabric resource",
          "required": true,
          "schema": {
            "type": "string"
          }
        }
      ],
      "get": {
        "tags": ["Orchestration Secrets"],
        "summary": "List all Secrets for a Fabric",
        "operationId": "listSecretsByFabric",
        "responses": {
          "200": {
            "description": "A list of Fabric Secrets",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Secret"
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Orchestration Secrets"],
        "summary": "Create a new Secret for a Fabric",
        "operationId": "createSecret",
        "requestBody": {
          "description": "Secret object to be created",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SecretCreate"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Secret created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Secret"
                }
              }
            }
          }
        }
      }
    },
    "/orchestration/fabric/{fabricId}/secret/id/{secretId}": {
      "parameters": [
        {
          "name": "fabricId",
          "in": "path",
          "description": "The unique ID of the parent Fabric resource",
          "required": true,
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "secretId",
          "in": "path",
          "description": "The unique ID of the Secret resource",
          "required": true,
          "schema": {
            "type": "string"
          }
        }
      ],
      "get": {
        "tags": ["Orchestration Secrets"],
        "summary": "Retrieve a specific Secret by ID",
        "operationId": "getSecretById",
        "responses": {
          "200": {
            "description": "Secret resource found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Secret"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": ["Orchestration Secrets"],
        "summary": "Update an existing Secret by ID",
        "operationId": "updateSecret",
        "requestBody": {
          "description": "Secret object with updated fields",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SecretUpdate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Secret updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Secret"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Orchestration Secrets"],
        "summary": "Delete a specific Secret by ID",
        "operationId": "deleteSecret",
        "x-mint": {
          "playground": "none"
        },
        "responses": {
          "204": {
            "description": "Secret deleted successfully"
          }
        }
      }
    },
    "/orchestration/fabric/{fabricId}/connection": {
      "parameters": [
        {
          "name": "fabricId",
          "in": "path",
          "description": "The unique ID of the parent Fabric resource",
          "required": true,
          "schema": {
            "type": "string"
          }
        }
      ],
      "get": {
        "tags": ["Orchestration Connections"],
        "summary": "List all Connections for a Fabric",
        "operationId": "listConnectionsByFabric",
        "responses": {
          "200": {
            "description": "A list of Fabric Connections",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Connection"
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Orchestration Connections"],
        "summary": "Create a new Connection for a Fabric",
        "operationId": "createConnection",
        "requestBody": {
          "description": "Connection object to be created",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ConnectionCreate"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Connection created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Connection"
                }
              }
            }
          }
        }
      }
    },
    "/orchestration/fabric/{fabricId}/connection/name/{connectionName}": {
      "parameters": [
        {
          "name": "fabricId",
          "in": "path",
          "description": "The unique ID of the parent Fabric resource",
          "required": true,
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "connectionName",
          "in": "path",
          "description": "The unique name of the Connection resource",
          "required": true,
          "schema": {
            "type": "string"
          }
        }
      ],
      "get": {
        "tags": ["Orchestration Connections"],
        "summary": "Retrieve a specific Connection by Name",
        "operationId": "getConnectionByName",
        "responses": {
          "200": {
            "description": "Connection resource found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Connection"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": ["Orchestration Connections"],
        "summary": "Update an existing Connection by Name",
        "operationId": "updateConnection",
        "requestBody": {
          "description": "Connection object with updated fields",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ConnectionUpdate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Connection updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Connection"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Orchestration Connections"],
        "summary": "Delete a specific Connection by Name",
        "operationId": "deleteConnection",
        "x-mint": {
          "playground": "none"
        },
        "responses": {
          "204": {
            "description": "Connection deleted successfully"
          }
        }
      }
    },
    "/api/trigger/pipeline": {
      "parameters": [
        {
          "name": "X-AUTH-TOKEN",
          "in": "header",
          "description": "Prophecy access token",
          "required": true,
          "schema": {
            "type": "string"
          }
        }
      ],
      "post": {
        "tags": ["Pipeline Runs"],
        "summary": "Trigger pipeline run",
        "description": "Trigger the execution of a pipeline in a deployed project. This is useful when you want to automate pipeline runs without relying on Prophecy's built-in scheduling.",
        "operationId": "triggerPipelineRun",
        "x-mint": {
          "content": "## Requirements\n\nTo run the API, the target pipeline must:\n\n- Run on a Prophecy fabric.\n- Be part of a published project.\n\nIn other words, the pipeline must be deployed."
        },
        "requestBody": {
          "description": "Pipeline run trigger parameters",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TriggerPipelineRequest"
              },
              "example": {
                "fabricId": 33290,
                "pipelineName": "bakehouse",
                "parameters": {
                  "franchise_id": "3000007"
                },
                "version": "2",
                "projectId": "41459",
                "processName": "franchise_reviews"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Pipeline run triggered successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TriggerPipelineResponse"
                },
                "examples": {
                  "error": {
                    "summary": "Response to a request with an invalid fabric ID",
                    "value": {
                      "success": false,
                      "msg": "error in triggering pipeline: Success(Left(sdl.md.client.package$MetadataException: Fabric with uid `2290` not found)) (of class scala.util.Success)"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/trigger/pipeline/{runId}": {
      "parameters": [
        {
          "name": "runId",
          "in": "path",
          "description": "Pipeline run ID",
          "required": true,
          "schema": {
            "type": "string",
            "example": "MDAw-xZGYzYzc3LTYzdsSdfx--LTQ3NTQ1ZYjI2Mw=="
          }
        },
        {
          "name": "X-AUTH-TOKEN",
          "in": "header",
          "description": "Prophecy access token",
          "required": true,
          "schema": {
            "type": "string"
          }
        }
      ],
      "get": {
        "tags": ["Pipeline Runs"],
        "summary": "Get pipeline run status",
        "description": "Get the status of a triggered pipeline run, including an error message if the pipeline run fails.",
        "operationId": "getPipelineRunStatus",
        "responses": {
          "200": {
            "description": "Pipeline run status retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PipelineRunStatus"
                },
                "example": {
                  "success": true,
                  "runId": "MDAw-xZGYzYzc3LTYzdsSdfx--LTQ3NTQ1ZYjI2Mw==",
                  "createdAt": "2025-06-17T18:01:49.275359",
                  "updatedAt": "2025-06-17T18:02:41.712486",
                  "projectId": "41459",
                  "pipelineName": "bakehouse",
                  "fabricId": "33290",
                  "runStatus": "SUCCEEDED"
                }
              }
            }
          }
        }
      }
    },
    "/api/deploy/project": {
      "parameters": [
        {
          "name": "X-AUTH-TOKEN",
          "in": "header",
          "description": "Prophecy access token",
          "required": true,
          "schema": {
            "type": "string"
          }
        }
      ],
      "post": {
        "tags": ["Project Deployment"],
        "summary": "Deploy project",
        "description": "Deploy projects with custom pipeline and project configurations to specific fabrics. Use this API to automate project deployment with external CI/CD tools or deploy the same project to different environments with different configuration values.",
        "operationId": "deployProject",
        "x-mint": {
          "content": "## Requirements\n\nTo run the API, you need to:\n\n- Reference a fabric that exists in your environment.\n- Use an existing Git tag that defines the project version.\n\n<Note>\nUnlike in the Prophecy UI where Git tags are created automatically during publish, when using this API you must create the Git tag externally. \n\nThe tag must follow the exact format `{projectName}/{version}`.\n</Note>\n\n## Parameter Precedence\n\nConfiguration parameters follow this precedence order:\n\n1. Pipeline parameter overrides (highest priority)\n2. Project configuration overrides\n3. Default pipeline parameters\n4. Default project configuration (lowest priority)"
        },
        "requestBody": {
          "description": "Project deployment parameters",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DeployProjectRequest"
              },
              "example": {
                "projectName": "CustomerAnalytics",
                "fabricName": "production-databricks",
                "gitTag": "CustomerAnalytics/2.1",
                "pipelineConfigurations": {
                  "sales_report": {
                    "report_period": "monthly",
                    "include_forecasts": "true"
                  },
                  "customer_segmentation": {
                    "segment_count": "5",
                    "min_customers_per_segment": "100"
                  },
                  "revenue_analysis": {
                    "currency": "USD",
                    "include_tax": "false"
                  }
                },
                "projectConfiguration": {
                  "environment": "production",
                  "data_refresh_frequency": "daily"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Project deployment response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DeployProjectResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Response to a successful deployment request",
                    "value": {
                      "success": true,
                      "message": "Project scheduled successfully",
                      "deploymentId": "212",
                      "details": {
                        "projectId": "67890",
                        "fabricId": "09123",
                        "version": "2.1",
                        "pipelinesDeployed": [
                          "sales_report",
                          "customer_segmentation",
                          "revenue_analysis"
                        ],
                        "configurationsApplied": 5
                      }
                    }
                  },
                  "error": {
                    "summary": "Response to a request with an invalid Git tag",
                    "value": {
                      "success": false,
                      "message": "Deployment failed",
                      "error": "Failed to fetch project files: Clone failed because revision Some(CustomerAnalytics/2.1) was not found"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Fabric": {
        "type": "object",
        "properties": {
          "fabricId": {
            "type": "string",
            "description": "The unique identifier for the Fabric."
          },
          "name": {
            "type": "string",
            "description": "The human-readable name of the Fabric."
          },
          "status": {
            "type": "string",
            "description": "The current status of the Fabric."
          }
        }
      },
      "FabricCreate": {
        "type": "object",
        "required": ["name"],
        "properties": {
          "name": {
            "type": "string",
            "description": "The human-readable name of the Fabric."
          },
          "config": {
            "type": "object",
            "description": "Configuration details for the Fabric."
          }
        }
      },
      "FabricUpdate": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "The human-readable name of the Fabric."
          },
          "config": {
            "type": "object",
            "description": "Configuration details for the Fabric."
          }
        }
      },
      "Secret": {
        "type": "object",
        "properties": {
          "secretId": {
            "type": "string",
            "description": "The unique identifier for the Secret."
          },
          "name": {
            "type": "string",
            "description": "The key name for the secret."
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "SecretCreate": {
        "type": "object",
        "required": ["name", "value"],
        "properties": {
          "name": {
            "type": "string",
            "description": "The key name for the secret."
          },
          "value": {
            "type": "string",
            "description": "The secret value (will not be returned on GET)."
          }
        }
      },
      "SecretUpdate": {
        "type": "object",
        "properties": {
          "value": {
            "type": "string",
            "description": "The updated secret value."
          }
        }
      },
      "Connection": {
        "type": "object",
        "properties": {
          "connectionName": {
            "type": "string",
            "description": "The unique name of the connection."
          },
          "type": {
            "type": "string",
            "description": "The type of connection (e.g., 'database', 'storage')."
          },
          "details": {
            "type": "object",
            "description": "Connection configuration details."
          }
        }
      },
      "ConnectionCreate": {
        "type": "object",
        "required": ["connectionName", "type", "details"],
        "properties": {
          "connectionName": {
            "type": "string",
            "description": "The unique name of the connection."
          },
          "type": {
            "type": "string",
            "description": "The type of connection (e.g., 'database', 'storage')."
          },
          "details": {
            "type": "object",
            "description": "Connection configuration details."
          }
        }
      },
      "ConnectionUpdate": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "The type of connection (e.g., 'database', 'storage')."
          },
          "details": {
            "type": "object",
            "description": "Updated connection configuration details."
          }
        }
      },
      "PipelineRunStatus": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "description": "Indicates whether the request to retrieve the pipeline run status was successful. It does not reflect the success of the run."
          },
          "runId": {
            "type": "string",
            "description": "Unique identifier of the pipeline run."
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when the pipeline run record was created. Returns ISO 8601 format, including microseconds."
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when the pipeline run record was last updated. Returns ISO 8601 format, including microseconds."
          },
          "projectId": {
            "type": "string",
            "description": "ID of the project associated with this pipeline run."
          },
          "pipelineName": {
            "type": "string",
            "description": "Name of the pipeline associated with this run."
          },
          "fabricId": {
            "type": "string",
            "description": "ID of the fabric where the pipeline resides."
          },
          "runStatus": {
            "type": "string",
            "enum": ["RUNNING", "ERROR", "SUCCEEDED"],
            "description": "Execution status of the pipeline run."
          },
          "errorMessage": {
            "type": "string",
            "description": "Descriptive error message if the runStatus is ERROR."
          }
        }
      },
      "TriggerPipelineRequest": {
        "type": "object",
        "required": ["fabricId", "pipelineName", "projectId"],
        "properties": {
          "fabricId": {
            "type": "integer",
            "format": "int64",
            "description": "Unique identifier of the data fabric where the pipeline resides. You can find the ID in the URL of the fabric metadata page."
          },
          "pipelineName": {
            "type": "string",
            "description": "Name of the pipeline to be triggered."
          },
          "projectId": {
            "type": "string",
            "description": "Unique ID of the project where the pipeline resides. You can find this string in the URL of the project editor or metadata page."
          },
          "parameters": {
            "type": "object",
            "additionalProperties": {
              "type": "string",
              "description": "Pipeline parameter name and value. The key is the name of a pipeline parameter, and the value is the parameter value to assign."
            },
            "description": "Map of key-value pairs representing pipeline parameters. These will override default parameter values."
          },
          "branch": {
            "type": "string",
            "description": "Specific branch of the pipeline to execute. If omitted, the current working branch is used."
          },
          "version": {
            "type": "string",
            "description": "Specific version of the project containing the pipeline. If omitted, the latest version is used."
          },
          "processName": {
            "type": "string",
            "description": "Name of a specific gem within the pipeline. If provided, the pipeline will not run beyond this gem. If no processName is specified, the full pipeline is executed."
          }
        }
      },
      "TriggerPipelineResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "description": "Indicates whether the request to trigger the pipeline was successful. It does not reflect the success of the pipeline run."
          },
          "runId": {
            "type": "string",
            "description": "Unique identifier of the pipeline run."
          },
          "msg": {
            "type": "string",
            "description": "Error message if the request to trigger the pipeline was unsuccessful."
          }
        }
      },
      "DeployProjectRequest": {
        "type": "object",
        "required": ["projectName", "fabricName", "gitTag"],
        "properties": {
          "projectName": {
            "type": "string",
            "description": "Name of the project to be deployed. Example: CustomerAnalytics"
          },
          "fabricName": {
            "type": "string",
            "description": "Name of the fabric where the project will be deployed. Example: production-databricks"
          },
          "gitTag": {
            "type": "string",
            "description": "Git tag identifying the specific version of the project to deploy. Must follow the format {projectName}/{version}."
          },
          "pipelineConfigurations": {
            "type": "object",
            "additionalProperties": {
              "type": "object",
              "description": "Pipeline name. The key is the name of a pipeline within the project.",
              "additionalProperties": {
                "type": "string",
                "description": "Parameter name and value. The key is the name of a pipeline parameter, and the value is the parameter value to assign."
              }
            },
            "description": "Override default values for specific pipeline parameters. Each pipeline can have multiple parameter overrides. The parameter must exist in the pipeline definition, or the override will be skipped.\n\nYou only need to specify the parameters you want to override. Any parameters not specified will use their default values from the pipeline definition. You can override just one parameter or multiple parameters as needed."
          },
          "projectConfiguration": {
            "type": "object",
            "additionalProperties": {
              "type": "string",
              "description": "Project configuration parameter name and value. The key is the project configuration variable name, and the value is the parameter value to assign."
            },
            "description": "Override default values for project-level configuration parameters that apply to all pipelines in the project."
          }
        }
      },
      "DeployProjectResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "description": "Indicates whether the request to deploy the project was successful."
          },
          "message": {
            "type": "string",
            "description": "Message that explains the outcome of the request."
          },
          "deploymentId": {
            "type": "string",
            "description": "Unique identifier of the deployment generated by this request."
          },
          "details": {
            "$ref": "#/components/schemas/DeploymentDetails"
          },
          "error": {
            "type": "string",
            "description": "Detailed error information provided when the request fails."
          }
        }
      },
      "DeploymentDetails": {
        "type": "object",
        "properties": {
          "projectId": {
            "type": "string",
            "description": "Unique identifier of the deployed project."
          },
          "fabricId": {
            "type": "string",
            "description": "Unique identifier of the fabric where the project was deployed."
          },
          "version": {
            "type": "string",
            "description": "Version number of the deployed project."
          },
          "pipelinesDeployed": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Array of pipeline names that were successfully deployed."
          },
          "configurationsApplied": {
            "type": "integer",
            "description": "Number of configuration parameters that were applied during deployment."
          }
        }
      }
    }
  }
}
